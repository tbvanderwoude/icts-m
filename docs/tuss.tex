\documentclass[a4paper,10pt,english]{article}
\usepackage[T1]{fontenc}
\usepackage{marginnote}
\include{prelude}
\usepackage{geometry}
\geometry{verbose,tmargin=3cm,bmargin=3cm,lmargin=3cm,rmargin=3cm}
\usepackage[backend=bibtex]{biblatex}
\addbibresource{sources.bib}
\usepackage{babel}


\title{Reviewed: Train Unit Shunting and Servicing: a Real-Life Application of Multi-Agent Path Finding}
\author{Thom van der Woude}
\date{\today}

\begin{document}
	\maketitle
	\paragraph{First run-through}
	Only heuristics can solve instances of the full TUSS problem currently, and little is known about the properties of the found solutions. Bounds for quality of heuristic solutions to TUSS instances are needed: only then can you really know what still can be achieved with current shunting yard capacity and an increasing number of trains, and can you say whether new investment is needed. This is why analysis of a relaxation is proposed as a way to establish bounds.
	
	MAPF: abstract collision-free routing for robots/automated vehicles through environments.
	
	Train Unit Shunting Problem (TUSP): the problem of parking and matching arriving train units to departures. Does not consider servicing at the yard! Maintainance/servicing tasks added as extensions, eventually resulting in the full Train Unit Shunting and Servicing problem: \cite{Artigues2014} first introduced full problem statement. Also showed only heuristic solutions are currently possible for practical instances. It envelopes everything that happens to a train outside of brining people from A to B. So the shunting of trains integrated with the scheduling of various servicing activities.
	"The  main  objective  of  this  work  is  therefore  to  identify  whether  MAPF models (and algorithms) can be used or extended to provide a relaxation of the TUSS problem. The contributions of this paper include an introduction of TUSS from the viewpoint of MAPF, and an analysis of similarities and differences to arrive at a relaxation of TUSS based on MAPF"
	
	Railway network: nodes/hubs are major cities. Hubs have both a station (for transport) and some yards (for shunting/servicing). Transport time-tables dictate the required output of the yards, as tuples of departure times and traintypes, but also when trains of certain types become available for further transport or service after reaching their destination. There is also a maintenance program dictating what tasks are to be done for specific train-types, dpeending on the state of the vehicle.
	
	"Informally speaking, the objective of the Train  Unit  Shunting  and  Service Problem is  to  find  a  feasible  schedule  for  all  activities  required  to  take  train units from a station platform to a yard, find conflict-free routes to tracks that are needed for the trains to get serviced and parked, and deliver the trains to the  transportation  process  as  specified,  while  respecting  all  kinds  of  resource constraints."
	
	Sub-problems: matching problem between trains to be delivered to transport system and those arriving/present in yard. There is also the resource-constrained scheduling of allocating service resources to trains that have to be serviced. Should consider conditional tasks. There is also the staff scheduling and rostering problem: staff can only drive trains for so long per day and so on. Then the parking problem: where to put the trains (that are perhaps waiting to be serviced)? This is like bin-packing. Then there is the coupling and decoupling problem to account for incombing and outbound train configurations, and the routing problem of driving trains from and to the yard without conflicts with transport/cargo trains and also visiting appropriate servicing/parking tracks.
	
	Take-away: there is a lot of complexity, a lot of things that ideally should be planned at once. Current approach: plan sequentially: first solve matching for decoupled train units, schedule maintenance tasks and so on.
	
	
	Bounds for hub capacity: depend on planning approach, 'dynamic' planning is used these days using up-to-date train-data. Current relaxed problem: models all subproblems except routing. Relaxed problem should be complete: no feasible solution to original problem should be infeasible when relaxed (so discarded)
	
	Related work: \cite{Freling2002} first mathematically modelled TUSP with track assignment and matching considered seperately. From there many model improvements to eventually TUSS. Only heuristic solutions, things like annealing and machine learning/local search really seem to work. 
	
	A complete solver is needed to show feasibility or infeasibility of instances.
	
	MAPF has already been solved at scale (see CBS, BCP), TUSS has not. Collision between agents? Branch and consider subproblems recursively.
	
	Novelty of paper: relaxations of TUSS for working towards solving TUSS at scale.
	\paragraph{MAPF definition that is extended}
	MAPF statement: different from that other one with actions as functions. Uses a space-time graph (time-extended graph). Given connected undirected graph $G = (L,E)$ with
	 locations $l \in L$, let $V = L \times \mathbb{Z}_+$ and let each $v = (l,t) \in V$ represent a combination of a location $l$ and time $t$. Now define the time-extended edge set $\hat E \subset V \times V$ with $e = (v_1,v_2) = ((l_1,t_1),(l_2,t_2))\in \hat E$ if and only if $t_2  = t_1 + 1$ and $(l_1,l_2)\in E$ or $l_1 = l_2$. Its reverse is defined as $e' = ((l_1,t_2),(l_2,t_1)) \in \hat E$ In words, this means that $\hat E$ represents points in space that can be reached at the next time-step if a certain action is chosen at the present time-step. Let $c(e) = 1$ denote the cost for each $e\in \hat E$. Let $a \in A$ be an agent with start and goal locations $s_a,g_a\in L$. A path $\pi$ of length $k\in\mathbb{Z}_+$ is a vector of locations $(l_0,l_1,\ldots,l_{k-1})$ where $l_0 = s_a, l_{k-1} = g_a$ and $((l_t,t),(l_{t+1},t+1))\in E_t$ for all $t\in\{0,1,\ldots,k-2\}$. For $t>k$ the agent is assumed to remain at $g_a$.
	 
	 What defines a solution then? A set of paths so that each vertex $v = (l,t)\in V$ is visited at most once and each edge $e$ and its reverse $e'$ are also visited in total at most once. Compare this to the more tedious formulation where feasible solutions had a quite complicated definition.
	 
	 Minimization: is there a set of paths $p_a$ with $a\in A$ such that the total cost of all edges in all paths $\sum_{a\in A} c(\pi_a) \leq k$ for some bound $k$? This is a PSPACE-complete decision problem.
	 
	 Note: matching is needed for MAPF to possibly be a relaxation of TUSS.
	 
	 Idea for instance translation: trains as agents, shunting yard as graph with tracks being represented by  a number of nodes (optimistic about the number of trains that could fit on it by dividing length by shortest train, rounding up). The goal is to now find paths to these tracks on which certain services can be performed so that trains collide neither on tracks or abstractly in resource allocation.
	 
	 \paragraph{Extensions}
	 Approach: starting with MAPF with matching, define series of progressively more detailed relaxations of TUSS.
	 
	 Second extension: direction of movement of trains is factored in. Third: set of service tasks is included for each agent. Fourth, some additional possible extensions in brief.
	 
	 
	 Matching: a bit like multi-commodity flow problem. Compositions of train units are set to leave the yard for transport, but unit identity is irrelevant, only type is considered. In reality these are coupled but this is first left out: it also only relaxes the problem further formally. Key assumption: as many train units of each type arrive as depart for the total problem instance. However, each agent $a$ is assigned an expected arrival time $t$ so that it's start node is $(l,t)\in V$ (not in $L$!), and also get assigned a type $o\in O$. Similarly, goal nodes get a $t$ so that they are also in $V$ and are marked with a certain train type that is to leave at that place and time. So $g = \{g_1 = (l_1,t_1,o_i),\ldots, g_n\}$.
	 
	 In practice you could have $t=0$ for all 'arrivals'/start nodes and fix departure times with the problem still being a relaxation.
	 
	 Direction of movement extension would have it cost $c_{rev}$ to reverse direction at a node. This is done by turning each node $v$ into a $v_l,v_r$ pair indicating leftward or rightward movement and an edge with cost $c_{rev}$ between them (and the implicit constraint that there can be at most one agent in total in $v_l,v_r$). This turns the problem into a variation of weighted MAPF.
	 
	 Including service tasks is important for the relaxation to really be relevant to TUSS and not just something like TUSP. Service tasks can be modelled as waypoints that agents should pass on their path. This means that on the per-agent level, you should do something not unlike TSP. Such a formulation ensures that order that the tasks are performed in is not considered, only completion of all tasks is and that agents can move over 'task'-nodes like any other location on the graph, possibly temporarely blocking other agents that need to be serviced there and so on.
	 
	 Other extensions:
	 Some locations cannot be used for parking (track changes/platforms): waiting is limited to few time-steps. Removing all wait edges there may not yield a relaxation always.
	 
	 The relation between train units, their servicing and trains as sequences of units is still an open question in modelling TUSS relaxations.
	 
	 How to model tracks more realistically? Pair train types with lengths and add constraints so that the trains on the nodes making up a track do not exceed the total length of the modelled track.
	 
	 Planning of personnel is important: drivers, maintenance crews, cleaners. Each have their expertise, are time-limited, and also have to physically make their way from one service track or train to the next. You could argue that when you want to learn the raw top capacity of an expensive shunting yard, you should not think about this too much. 
	 
	 Next: you could star tlooking at motion-planning-like things: trains have variable speed, changing momentum takes time, and because of this and other safety requirements there are limits on speed and the minimum time between two trains crossing the same track change and similar locations. Formulating this as strictly a relaxation is difficult (you can easily be too strict).
	
	 
	 \paragraph{Conclusion}
	 There are many practical details in TUSS: many subproblems to consider and factor in. To work towards upper-bound analysis, the MAPF with matching relaxation is considered and a naïve method of converting between TUSS and relaxed MAPF with matching instances is given. The space-time-graph formulation is interesting as it enables simple modelling of arrival and departure times of different units. Direction and cost of reversal can easily be modelled, although it does require considering the properties of weighted MAPF. Task waypoints can model servicing/maintenance work that has to be done.
	 
	 Something totally different: consider restrictions rather than relaxations to limit the search for solutions.
	 
	 Lastly: there is more to TUSS and therefore relaxations than feasibility: cost in terms of personnel and so on is also relevant and should ideally be minimized. Practically, this could be done by minimizing simultaneous actions in solutions. At this point there simply isn't much 'choice' in picking solutions however: you just have to hope that what the heuristic search outputs is good.
	\printbibliography
	
\end{document}
